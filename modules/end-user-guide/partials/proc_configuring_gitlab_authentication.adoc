// configuring-gitlab-authentication

[id="configuring_gitlab_authentication_{context}"]
= Authenticating on Gitlab servers

Configuring authentication on Gitlab system is a very similar to Bitbucket.

Gitlab authentication is based on using personal access tokens. Each Gitlab user is able to request some
amount of personal access tokens with different names, permissions, expiration times, and so on. Those tokens
can be used to sign Gitlab REST API calls and perform Git repository operations.

To allow Gitlab authentication on {prod} side, personal tokens must be stored in user's namespace in a form of
secret. The secret must look as follows:

[source,yaml]
----
include::example$snip_gitlab-personal-access-token-secret.adoc[]
----

The main parts of the secret are:

[cols=3*]
|===
| Label
| `app.kubernetes.io/component`
| Indicates it is a SCM personal token secret. 

| Annotation
| `che.eclipse.org/che-userid`
| {prod} id of the user token belongs to

| Annotation
| `che.eclipse.org/scm-userid`
| Gitlab user id to which token belongs

| Annotation
| `che.eclipse.org/scm-username`
| Gitlab user name to which token belongs

| Annotation
| `che.eclipse.org/scm-url`
| Gitlab server URL to which this token belong

| Annotation
| `che.eclipse.org/expired-after`
| Personal access token expiration time

| Data entry
| `token`
| Base-64 encoded value of the personal access token

|===

NOTE: Encoding a string into the base64 format using the `base64` tool on Linux machines leads to adding the newline character to the end of the source string and causing a value to be unusable as the authentication header value after decoding. Avoid this by using `base64 -w0`, which removes newly added lines, or strip newlines explicitly using`tr -d \\n`.

. To obtain a user ID from a secret take a look into user profile page on Gitlab web UI or make a call to a REST API URL:
*  For Gitlab:
+
[subs="+quotes"]
----
https://__<gitlab-hostname>__/api/v4/users?username=__<username>__
----

* For {prod-short}
+
[subs="+attributes,+quotes"]
----
{prod-url}/api/user
----

* With the token credentials obtained from a secret, another secret is automatically created, allowing authorization to Git operations. This secret is mounted into a workspace container as a Git credentials file, and any additional configurations are not required to work with private Git repositories.

* When a remote Git repository uses a self-signed certificate, add an additional server configuration. See:
xref:installation-guide:deploying-che-with-support-for-git-repositories-with-self-signed-certificates.adoc[].