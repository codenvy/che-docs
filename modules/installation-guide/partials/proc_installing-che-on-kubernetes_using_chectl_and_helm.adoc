// Module included in the following assemblies:
//
// installing-{prod-id-short}-on-google-cloud-platform
// installing-{prod-id-short}-on-aws
// installing-{prod-id-short}-on-microsoft-azure


[id="installing-{prod-id-short}-on-kubernetes-using-{prod-cli}_and_helm_{context}"]
= Installing {prod-short} on {k8s-platform} using {prod-cli}

.Prerequisites

* The `{prod-cli}` management tool is available. See xref:using-the-chectl-management-tool.adoc[].
* The `helm` tool is available, with version 2.15 or higher. See link:https://helm.sh/[Helm].

.Procedure

* To install {prod-short} on {k8s-platform}, run the following `{prod-cli}` command:
+
[subs="+attributes"]
----
$ {prod-cli} server:deploy --installer=helm --platform=k8s --domain={domain} --multiuser
  ✔ Verify Kubernetes API...OK
  ✔ 👀  Looking for an already existing {prod} instance
    ✔ Verify if {prod} is deployed into {orch-namespace} "{prod-namespace}"...it is not
  ✔ ✈️  {kubernetes} preflight checklist
    ✔ Verify if kubectl is installed
    ✔ Verify remote kubernetes status...done.
    ✔ Check {kubernetes} version: Found v1.15.12-gke.2.
    ✔ Verify domain is set...set to {domain}.
    ↓ Check if cluster accessible [skipped]
  ✔ Start following logs
    ↓ Start following Operator logs [skipped]
    ✔ Start following {prod} logs...done
    ✔ Start following Postgres logs...done
    ✔ Start following {identity-provider} logs...done
    ✔ Start following Plugin registry logs...done
    ✔ Start following Devfile registry logs...done
  ✔ Start following events
    ✔ Start following {orch-namespace} events...done
 ›   Warning: Consider using the more reliable 'OLM' installer when deploying a stable release of {prod-short} (--installer=olm).
  ✔ 🏃‍  Running Helm to install {prod}
    ✔ Verify if helm is installed
    ✔ Check Helm Version: Found v3.1.2+gd878d4d
    ✔ Create Namespace (che)...does already exist.
    ✔ Check {prod} TLS certificate...TLS certificate secret found
    ✔ Check Cluster Role Binding...does not exists.
    ✔ Preparing {prod} Helm Chart...done.
    ✔ Updating Helm Chart dependencies...done.
    ✔ Deploying {prod} Helm Chart...done.
  ✔ ✅  Post installation checklist
    ✔ PostgreSQL pod bootstrap
      ✔ scheduling...done.
      ✔ downloading images...done.
      ✔ starting...done.
    ✔ Devfile registry pod bootstrap
      ✔ scheduling...done.
      ✔ downloading images...done.
      ✔ starting...done.
    ✔ Plugin registry pod bootstrap
      ✔ scheduling...done.
      ✔ downloading images...done.
      ✔ starting...done.
    ✔ {prod} pod bootstrap
      ✔ scheduling...done.
      ✔ downloading images...done.
      ✔ starting...done.
    ✔ Retrieving {prod} server URL... https://{prod-namespace}-{prod-namespace}.{domain}
    ✔ {prod} status check
  ✔ Show important messages
    ✔ Autogenerated {identity-provider} credentials are: "xxx:xxx"
Command server:deploy has completed successfully.
----

.Verification steps

. Track installation events with:
+
[subs="+attributes"]
----
$ kubectl get events --namespace {prod-namespace} --sort-by=.metadata.creationTimestamp
----

. Verify that certificates are set correctly
.. Open {prod} server URL from the output above
.. Click on the lock in address bar
.. Verify it has **Connection is secure**

.Additional resources

* xref:end-user-guide:navigating-che-using-the-dashboard.adoc[].
