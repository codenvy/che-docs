
# Building the Che documentation

This document describes how to build the documentation.
Following workflows are available:

* xref:building-the-documentation-using-pre-commit-and-containers-to-validate-the-changes[]
* xref:building-the-documentation-using-a local-installation-of-antora-to-browse-the-documentation-website-locally[]


[id="building-the-documentation-using-pre-commit-and-containers-to-validate-the-changes"]
## Building the documentation using `pre-commit` and containers to validate the changes

This section describes how to build the documentation with `pre-commit` and containers.
This workflow also validates the new content against style guide rules.
It doesn't start a server to browse the documentation website locally.

.Prerequisites

* A running version of `pre-commit`. See https://pre-commit.com/#install
* A running version of docker or podman.
* When using `podman`, implement the following workaround: https://github.com/pre-commit/pre-commit/issues/1243#issuecomment-635880316

.Procedure

. Open a shell into the project directory.

. Stage the files to check.
+
----
$ git add <path>/<to><files>
----
+
[WARNING]
====
`pre-commit` is stashing unstaged files and doesn't analyze them.
====

. Run the following command to build the documentation with Antora, validate the content against the Style Guide with Vale, and others.
+
----
$ pre-commit
----
+
.Example output
====
----
pre-commit
[WARNING] Unstaged files detected.
[INFO] Stashing unstaged files to /$HOME/.cache/pre-commit/patch1590757127.
Check hooks apply to the repository..................(no files to check)Skipped
Check for useless excludes...........................(no files to check)Skipped
List files to watch..................................(no files to check)Skipped
- hook id: identity
Build documentation with Antora..........................................Passed
- hook id: antora
- duration: 15.81s

asciidoctor: WARNING: skipping reference to missing attribute: che_port
asciidoctor: WARNING: skipping reference to missing attribute: che_local_git_repo
asciidoctor: WARNING: skipping reference to missing attribute: che_port
asciidoctor: WARNING: skipping reference to missing attribute: k8s-namespace
asciidoctor: WARNING: skipping reference to missing attribute: workspaceid
asciidoctor: WARNING: skipping reference to missing attribute: originalpvcname
asciidoctor: WARNING: skipping reference to missing attribute: ws-id
asciidoctor: WARNING: skipping reference to missing attribute: admin-context
asciidoctor: WARNING: skipping reference to missing attribute: pv
asciidoctor: WARNING: skipping reference to missing attribute: ws-id
asciidoctor: WARNING: skipping reference to missing attribute: orch-cli
asciidoctor: WARNING: skipping reference to missing attribute: orch-cli
asciidoctor: WARNING: skipping reference to missing attribute: orch-cli
asciidoctor: WARNING: skipping reference to missing attribute: orch-cli
asciidoctor: WARNING: proc_creating-a-google-kubernetes-engine-instance.adoc: line 7: id assigned to section already in use: creating-a-google-kubernetes-engine-instance_che
asciidoctor: WARNING: proc_installing-che-on-openshift-3-using-the-operator.adoc: line 7: id assigned to section already in use: installing-che-on-openshift-3-using-the-operator_che

Validate Style Guide with Vale...........................................Passed
- hook id: vale
- duration: 1.47s
----
====

* To ensure a `pre-commit` run for each new commit:
+
----
pre-commit install --install-hooks --overwrite
----

.Additional information

* link:https://pre-commit.com[]


[id="building-the-documentation-using-a local-installation-of-antora-to-browse-the-documentation-website-locally"]
## Building the documentation using a local installation of Antora to browse the documentation website locally

This section describes how to build the documentation with a local installation of Antora.
This workflow also starts a server to browse the documentation website locally on http://localhost:4000/.
It doesn't validate the new content against style guide rules.

.Prerequisites

* A running version of yarn. See link:https://yarnpkg.com/getting-started/install[Installing Yarn].
* `./node_modules/.bin` is in the `PATH` environment variable.

.Procedure

. Open a shell into the project directory.

. Install Antora and Gulp using yarn:
+
----
$ yarn
----

. Run following command:
+
----
$ gulp
---- 

. Preview Site starts and is available on http://0.0.0.0:4000

## Upgrading a local installation of Antora to a new version

. Open a shell into the project directory.

. Run following command:
+
----
$ yarn upgrade
----

. Commit the changes in both files `package.json` and `package-lock.json`.
+
----
$ git add package.json yarn.lock
$ git commit -m "Upgrade Antora to new version"
----

. Then build the documentation as usual

