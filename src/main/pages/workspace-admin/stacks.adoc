---
title: "Stacks"
keywords: workspace, runtime, recipe, docker, stack
tags: [workspace, runtime, docker, kubernetes]
sidebar: user_sidebar
permalink: stacks.html
folder: workspace-admin
---


[id="what-are-stacks"]
== Stack overview

A stack is a link:workspace-data-model.html[workspace configuration] template. Stacks are used to create workspaces in the user dashboard. The stack includes meta-information such as scope, tags, components, description, name and identification.  You can filter stacks by machine type and scope. The type is either single machine or multi machine.  You can also search for a stack by keyword. Stacks are displayed in the user dashboard on the Create a workspace page.

See the link:creating-starting-workspaces.html[Creating and starting workspaces user guide] for more information.

[id="community-supported-stacks"]
== Community supported stacks

Che includes some stacks and sample applications that are pre-configured and tested. Stacks that are contributed by the Che community are not tested. Community stacks are located in the https://github.com/che-samples/community-stacks[Community stacks GitHub repo].

Each directory has `${technology}-stack.json` and `${technology}-samples.json`.

To import a stack, follow these steps:

.  Copy the content of the JSON.
.  Go to `${CHE_HOST}/swagger/#!/stack/createStack`.
.  Paste the JSON content to to request body field.
.  Click *Try it out* button.

You can choose a different name or ID when there is a conflict with the stack ID or name.

For a multi-user setup, you can make your stack available for a particular user or all users in the system.  See link:#stack-sharing-and-system-stacks[stack sharing] for more information.

To import sample applications, move `*-stacks.json` files to:

* `${LOCAL_STORAGE}/instance/data/templates` for Docker infrastructure.
* `${mount-path-of-che-data-volume}/templates` for OpenShift and Kubernetes infrastructure. You need administrator privileges to get the host path and to access the host directory. Also, the new JSONs have the same permissions as the original `samples.json`.

You can find Docker files for all stacks in the https://github.com/eclipse/che-dockerfiles[Che Dockerfiles repository].

[id="stack-sharing-and-system-stacks"]
== Sharing stacks and system stacks

You can share stacks with selected users or with all users in the system if you have system privileges.  You share stacks by making REST calls.

To share stacks with users:

* Log in as administrator
* Go to `/swagger/#!/stack/searchStacks` to get a list of all stacks (you may filter search by tags).
* Find your stack by name and get its ID.
* The next API to use is: `/swagger/#!/permissions`
* Find the below POST method:

image::workspaces/stack_permissions.png[]

* Use the following JSON (replace `${STACK_ID}` with an actual ID)

[source,json]
----
{
"userId": "*",
  "domainId": "stack",
  "instanceId": "${STACK_ID}",
  "actions": [
    "read",
    "search"
  ]
}
----

If you get 204, all the users in the system see the stack. If you want to share a stack with a particular user, use the stack ID instead of `*` in the JSON.

The administrator can remove pre-configured stacks and replace them with custom stacks. The adminstrator can also remove permissions from stacks.  You can create stacks either in the user dashboard or by using any REST client. You can use Swagger (`$CHE_HOST:$CHE_PORT/swagger`) to bundle with Che.

[id="stacks-loading"]
== Stack management

Stacks are loaded from JSON files. You can not modify the JSON file that is packaged with the workspace master.  You can perform stack management using REST APIs in the user dashboard.
You can change the default policy in the JSON file when the user first starts Che and the database is initialized.   To get stack updates, set `CHE_PREDEFINED_STACKS_RELOADONSTART=true` in `che.env`. When set to true, stacks.json is used to update Che database each time the Che server starts. This means Che gets all the stacks in `stacks.json` and uploads the stacks to a database.
 You can keep existing custom stacks and get stack updates from new Che releases. New and edited stacks are merged. Name conflicts are possible. For example, a name conflicts happens  if a new Che version provides a new stack with the name My Cool Stack  and a stack with this name already exists in a database.  The stack name , My Cook Stack, is not saved to a database.

When a user first starts Che and the database is initialized, stacks are loaded from the JSON files.  You can change this default policy.

You can not modify the JSON file that is packaged with the workspace master.  You can perform stack management using REST APIs in the user dashboard.
