[id="mount-secret-as-a-environment-variable-in-workspace-container_{context}"]
= Mount secret as a environment variable into workspace container


This section describes how to mount an secret from user-s namespace as a environment variable(s) into a single or
multiple workspace containers of {prod}.

.Prerequisites

* A running instance of {prod}. To install an instance of {prod}, see link:{site-baseurl}che-7/che-quick-starts/[{prod-short} 'quick-starts'].

.Procedure

* Create secret in user namespace following those rules :

Labels must match the set of labels configured in `che.workspace.provision.secret.labels`
property of {prod}. By default it is a set of two labels:

[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: mvn-settings-secret
  labels:
    app.kubernetes.io/part-of: che.eclipse.org
    app.kubernetes.io/component: workspace-secret
...
----


Annotations must contain specific items, indicating that given secret should be mount as env variables,
providing variable names, and, optionally, specify container name where this mount should be applied.
If there is no target-container annotation, secret will be mount into all user containers of the workspace.

[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: mvn-settings-secret
  annotations:
    che.eclipse.org/target-container: maven
    che.eclipse.org/env-name: FOO_ENV
    che.eclipse.org/mount-as: env
  labels:
   ...
data:
  mykey: myvalue
----

This will resulting in environment variable with name `FOO_ENV` and value `myvalue` being
provisioned into container named `maven`.



If the secret provides more than one data item, environment variable name must be provided for each of
the data key, as follows:

[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: mvn-settings-secret
  annotations:
    che.eclipse.org/target-container: maven
    che.eclipse.org/mount-as: env
    che.eclipse.org/mykey_env-name: FOO_ENV
    che.eclipse.org/otherkey_env-name: OTHER_ENV
  labels:
   ...
data:
  mykey: myvalue
  otherkey: othervalue
----

Please note that maximum length of annotation names in Kubernetes is 63 symbols (excluding prefix ending with `/`),
so maximum length of the data key names in this case cannot be more that 55 symbols due to maximum length
of the `org.eclipse.che/<datakey>_env-name` annotation key.

This will resulting in two environment variables with names `FOO_ENV` and `OTHER_ENV` and values `myvalue` and `othervalue`, respectively,  being provisioned into container named `maven`.



