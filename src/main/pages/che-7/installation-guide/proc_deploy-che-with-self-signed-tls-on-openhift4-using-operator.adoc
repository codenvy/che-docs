[id="deploy-{prod-id-short}-with-self-signed-tls-on-openshift4-using-operator_{context}"]
= Deploy {prod-short} with self signed TLS certificates on Openshift 4 using operator

This section describes how to deploy {prod-short} with self-signed TLS certificates on Openshift 4 container platform.


[discrete]
== Prerequisites

* Have all required keys/certificates generated


[discrete]
== Procedure

. Login into Openshift default project

+
[subs="+quotes"]
----
$ oc login -u kubeadmin -p <password>
----


. Replace default ingress certificate with generated one

+
[subs="+quotes"]
----
$ oc delete secret router-certs -n openshift-ingress
$ cat domain.crt domain.key > openshift.crt
$ oc create secret tls router-certs --key=domain.key --cert=openshift.crt -n openshift-ingress
----

. Patch ingress controller configuration to use new secret

+
[subs="+quotes"]
----
$ oc patch ingresscontroller.operator default \
    --type=merge \
    -p '{"spec":{"defaultCertificate": {"name": "router-certs"}}}' \
    -n openshift-ingress-operator
----

See link:https://docs.openshift.com/container-platform/4.1/authentication/certificates/replacing-default-ingress-certificate.html[Replacing default ingress certificate] for details.


. Pre-create namespace for {prod-short}

+
[subs="+quotes"]
----
$ oc create namespace che
----


. Create secret from CA certificate

+
[subs="+quotes"]
----
$ cp rootCA.crt ca.crt
$ oc create secret generic self-signed-certificate --from-file=ca.crt -n=che
----


. Deploy {prod-short} using `chectl`

+
[subs="+quotes"]
----
$ chectl server:start --platform=crc --installer=operator --tls --self-signed-cert
----
